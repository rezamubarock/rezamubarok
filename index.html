<!DOCTYPE html>
<html lang="id" data-theme="dark" data-time="night">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="description" content="Reza Mubarok - Personal Links & Portfolio">
  <title>Reza Mubarok</title>

  <!-- iOS PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Reza">
  <meta name="theme-color" content="#1c1c1e">

  <link rel="stylesheet" href="styles.css">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
  <link rel="apple-touch-icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
  <script src="auth.js"></script>
</head>

<body>

  <!-- iOS Status Bar (Mobile Only) -->
  <div class="ios-status-bar" id="ios-status-bar">
    <div class="left">üì∂ 5G</div>
    <div class="time" id="ios-time">21:45</div>
    <div class="right">üîã 100%</div>
  </div>

  <!-- Login Screen -->
  <div class="login-screen" id="login-screen">
    <div class="login-box">
      <div class="login-avatar">üîí</div>
      <div class="login-name">Reza Mubarok</div>
      <div class="login-input-wrapper">
        <input type="password" class="login-input" id="password-input" placeholder="Enter Password" autocomplete="off">
      </div>
      <div class="login-hint">Press Enter to unlock</div>
    </div>
    <div class="login-time" id="login-time"></div>
    <div class="login-date" id="login-date"></div>
  </div>

  <!-- Menu Bar -->
  <nav class="menubar">
    <div class="menubar-left">
      <div class="dropdown" id="apple-dropdown">
        <span class="logo menubar-item">üçé</span>
        <div class="dropdown-menu">
          <div class="dropdown-item" onclick="showAbout()">
            <span class="emoji">‚ÑπÔ∏è</span> About This Site
          </div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="window.location.reload()">
            <span class="emoji">üîÑ</span> Refresh
          </div>
          <div class="dropdown-item" onclick="lockScreen()">
            <span class="emoji">üîí</span> Lock Screen
          </div>
        </div>
      </div>
      <div class="dropdown" id="name-dropdown">
        <span class="menubar-item">Reza Mubarok</span>
        <div class="dropdown-menu">
          <div class="dropdown-item" onclick="showAbout()">
            <span class="emoji">üë§</span> About Me
          </div>
          <div class="dropdown-item" onclick="window.open('mailto:admin@rezamubarok.com', '_blank')">
            <span class="emoji">‚úâÔ∏è</span> Send Email
          </div>
        </div>
      </div>
      <div class="dropdown" id="links-dropdown">
        <span class="menubar-item">Links</span>
        <div class="dropdown-menu" id="links-menu">
          <!-- Links will be populated from JSON -->
        </div>
      </div>
      <div class="dropdown" id="about-dropdown">
        <span class="menubar-item">About</span>
        <div class="dropdown-menu">
          <div class="dropdown-item" onclick="showAbout()">
            <span class="emoji">üë§</span> About Me
          </div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showCredits()">
            <span class="emoji">‚ù§Ô∏è</span> Credits
          </div>
        </div>
      </div>
    </div>
    <div class="menubar-right">
      <span id="current-time" class="menubar-item"></span>
      <span class="theme-toggle" id="theme-toggle" title="Toggle Theme">üåô</span>
    </div>
  </nav>

  <!-- Desktop Area -->
  <main class="desktop">
    <div class="desktop-greeting fade-in">
      <h1>Reza Mubarok</h1>
      <p class="subtitle">Developer ‚Ä¢ Creator ‚Ä¢ Marketer</p>
      <p class="dua floating">ALLAHUMMA SUGEH</p>
    </div>

    <!-- Search Bar -->
    <div class="search-container fade-in">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="search-input" placeholder="Search links..." autocomplete="off">
        <span class="search-clear" id="search-clear" style="display: none;">‚úï</span>
      </div>
      <div class="search-results" id="search-results"></div>
    </div>

    <div class="desktop-icons fade-in" id="desktop-icons">
      <!-- Icons will be loaded from JSON -->
    </div>
  </main>

  <!-- Folder Windows Container -->
  <div id="folder-windows"></div>

  <!-- About Modal -->
  <div class="modal-overlay" id="about-modal">
    <div class="modal">
      <h2>üë®‚Äçüíª Reza Mubarok</h2>
      <p>Developer, creator, and digital explorer based in Indonesia. Building tools and experiences that matter.</p>
      <p style="font-size: 12px; color: var(--text-secondary);">üïå ALLAHUMMA SUGEH</p>
      <button class="modal-btn" onclick="closeModal('about-modal')">Close</button>
    </div>
  </div>

  <!-- Credits Modal -->
  <div class="modal-overlay" id="credits-modal">
    <div class="modal">
      <h2>‚ù§Ô∏è Credits</h2>
      <p>Inspired by macOS design language by Apple Inc.</p>
      <p>Built with vanilla HTML, CSS, and JavaScript.</p>
      <p style="font-size: 12px;">¬© 2026 Reza Mubarok</p>
      <button class="modal-btn" onclick="closeModal('credits-modal')">Close</button>
    </div>
  </div>

  <!-- Private Folder Password Modal -->
  <div class="modal-overlay" id="private-modal">
    <div class="modal">
      <h2>üîê Private Folder</h2>
      <p>This folder is password protected.</p>
      <div class="login-input-wrapper" style="margin: 20px 0;">
        <input type="password" class="login-input" id="private-password" placeholder="Enter Password" autocomplete="off"
          style="background: var(--bg-secondary); color: var(--text-primary);">
      </div>
      <p id="private-error" style="color: #ff5f57; font-size: 12px; display: none;">Wrong password!</p>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="modal-btn" style="background: var(--text-secondary);"
          onclick="closeModal('private-modal')">Cancel</button>
        <button class="modal-btn" onclick="submitPrivatePassword()">Unlock</button>
      </div>
    </div>
  </div>

  <!-- Private Folder Window -->
  <div class="folder-window" id="folder-Private">
    <div class="folder-header">
      <div class="folder-controls">
        <div class="folder-control close" onclick="closeFolder('Private')"></div>
        <div class="folder-control minimize"></div>
        <div class="folder-control maximize"></div>
      </div>
      <span class="folder-title">üîê Private</span>
    </div>
    <div class="folder-content" id="private-folder-content">
      <!-- Will be loaded from private-links.json -->
    </div>
  </div>


  <!-- Dock -->
  <div class="dock-container">
    <div class="dock" id="dock">
      <!-- Dock items will be loaded from JSON -->
    </div>
  </div>

  <script>
    // ========================================
    // Authentication
    // ========================================
    const loginScreen = document.getElementById('login-screen');
    const passwordInput = document.getElementById('password-input');

    // Check if already authenticated
    if (checkAuth()) {
      loginScreen.classList.add('hidden');
    }

    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        if (validateAccess(passwordInput.value)) {
          setAuth();
          loginScreen.classList.add('hidden');
        } else {
          passwordInput.classList.add('error');
          passwordInput.value = '';
          setTimeout(() => passwordInput.classList.remove('error'), 500);
        }
      }
    });

    function lockScreen() {
      clearAuth();
      loginScreen.classList.remove('hidden');
      passwordInput.value = '';
      passwordInput.focus();
      closeAllDropdowns();
    }

    // ========================================
    // Time-based Theme
    // ========================================
    function updateTimeBasedTheme() {
      const hour = new Date().getHours();
      const html = document.documentElement;
      let timeOfDay, theme;

      if (hour >= 5 && hour < 7) {
        timeOfDay = 'dawn';
        theme = 'light';
      } else if (hour >= 7 && hour < 12) {
        timeOfDay = 'morning';
        theme = 'light';
      } else if (hour >= 12 && hour < 16) {
        timeOfDay = 'afternoon';
        theme = 'light';
      } else if (hour >= 16 && hour < 18) {
        timeOfDay = 'sunset';
        theme = 'light';
      } else if (hour >= 18 && hour < 21) {
        timeOfDay = 'evening';
        theme = 'dark';
      } else {
        timeOfDay = 'night';
        theme = 'dark';
      }

      // Only auto-set if user hasn't manually toggled
      if (!localStorage.getItem('manualTheme')) {
        html.setAttribute('data-theme', theme);
        document.getElementById('theme-toggle').textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      }

      html.setAttribute('data-time', timeOfDay);
    }

    updateTimeBasedTheme();
    setInterval(updateTimeBasedTheme, 60000); // Update every minute

    // ========================================
    // Theme Toggle (Manual Override)
    // ========================================
    const themeToggle = document.getElementById('theme-toggle');
    const html = document.documentElement;

    // Load saved manual theme if exists
    const savedTheme = localStorage.getItem('manualTheme');
    if (savedTheme) {
      html.setAttribute('data-theme', savedTheme);
      themeToggle.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      themeToggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('manualTheme', newTheme);
    });

    // Double click to reset to auto
    themeToggle.addEventListener('dblclick', () => {
      localStorage.removeItem('manualTheme');
      updateTimeBasedTheme();
    });

    // ========================================
    // Clock
    // ========================================
    function updateClock() {
      const now = new Date();

      // Menubar clock
      const menuOptions = {
        weekday: 'short',
        day: 'numeric',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      };
      document.getElementById('current-time').textContent =
        now.toLocaleDateString('id-ID', menuOptions);

      // Login screen clock
      const loginTime = document.getElementById('login-time');
      const loginDate = document.getElementById('login-date');
      if (loginTime) {
        loginTime.textContent = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
      }
      if (loginDate) {
        loginDate.textContent = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' });
      }

      // iOS Status Bar clock
      const iosTime = document.getElementById('ios-time');
      if (iosTime) {
        iosTime.textContent = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
      }
    }
    updateClock();
    setInterval(updateClock, 1000);

    // Hide iOS status bar on desktop
    function checkMobile() {
      const statusBar = document.getElementById('ios-status-bar');
      if (statusBar) {
        statusBar.style.display = window.innerWidth <= 480 ? 'flex' : 'none';
      }
    }
    checkMobile();
    window.addEventListener('resize', checkMobile);

    // ========================================
    // Dropdown Menus
    // ========================================
    const dropdowns = document.querySelectorAll('.dropdown');

    dropdowns.forEach(dropdown => {
      const trigger = dropdown.querySelector('.menubar-item, .logo');
      trigger.addEventListener('click', (e) => {
        e.stopPropagation();
        closeAllDropdowns();
        dropdown.classList.add('active');
      });
    });

    function closeAllDropdowns() {
      dropdowns.forEach(d => d.classList.remove('active'));
    }

    document.addEventListener('click', closeAllDropdowns);

    // ========================================
    // Modals
    // ========================================
    function showAbout() {
      document.getElementById('about-modal').classList.add('active');
      closeAllDropdowns();
    }

    function showCredits() {
      document.getElementById('credits-modal').classList.add('active');
      closeAllDropdowns();
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
        }
      });
    });

    // ========================================
    // Load Links from JSON
    // ========================================
    let linksData = null;

    async function loadLinks() {
      try {
        const response = await fetch('links.json');
        linksData = await response.json();
        renderDesktopIcons();
        renderDock();
        createFolderWindows();
        populateLinksMenu();
      } catch (error) {
        console.error('Error loading links:', error);
      }
    }

    // Populate Links dropdown in menubar
    function populateLinksMenu() {
      const menu = document.getElementById('links-menu');
      menu.innerHTML = '';

      linksData.categories.forEach((category, idx) => {
        const item = document.createElement('div');
        item.className = 'dropdown-item';
        item.innerHTML = `<span class="emoji">${category.icon}</span> ${category.name}`;
        item.onclick = () => {
          openFolder(category.name);
          closeAllDropdowns();
        };
        menu.appendChild(item);

        if (idx < linksData.categories.length - 1) {
          const divider = document.createElement('div');
          divider.className = 'dropdown-divider';
          menu.appendChild(divider);
        }
      });
    }

    // ========================================
    // Render Desktop Icons (Categories as Folders)
    // ========================================
    function renderDesktopIcons() {
      const container = document.getElementById('desktop-icons');
      container.innerHTML = '';

      linksData.categories.forEach((category, index) => {
        const icon = document.createElement('div');
        icon.className = 'desktop-icon';
        icon.style.animationDelay = `${index * 0.1}s`;
        icon.innerHTML = `
          <span class="icon">${category.icon}</span>
          <span class="label">${category.name}</span>
        `;
        icon.addEventListener('click', () => openFolder(category.name));
        container.appendChild(icon);
      });

      // Add Private folder icon
      const privateIcon = document.createElement('div');
      privateIcon.className = 'desktop-icon';
      privateIcon.style.animationDelay = `${linksData.categories.length * 0.1}s`;
      privateIcon.innerHTML = `
        <span class="icon">üîê</span>
        <span class="label">Private</span>
      `;
      privateIcon.addEventListener('click', () => openPrivateFolder());
      container.appendChild(privateIcon);
    }

    // ========================================
    // Render Dock
    // ========================================
    function renderDock() {
      const dock = document.getElementById('dock');
      dock.innerHTML = '';

      linksData.dock.forEach((item, index) => {
        const dockItem = document.createElement('div');
        dockItem.className = 'dock-item';
        dockItem.innerHTML = `
          <span class="icon">${item.icon}</span>
          <span class="tooltip">${item.title}</span>
        `;

        if (item.link.startsWith('#folder-')) {
          const folderName = item.link.replace('#folder-', '');
          dockItem.addEventListener('click', () => openFolder(folderName));
        } else if (item.link !== '#') {
          dockItem.addEventListener('click', () => window.open(item.link, '_blank'));
        }

        dock.appendChild(dockItem);

        // Add divider after first 2 items
        if (index === 1) {
          const divider = document.createElement('div');
          divider.className = 'dock-divider';
          dock.appendChild(divider);
        }
      });
    }

    // ========================================
    // Create Folder Windows
    // ========================================
    function createFolderWindows() {
      const container = document.getElementById('folder-windows');
      container.innerHTML = '';

      linksData.categories.forEach(category => {
        const folder = document.createElement('div');
        folder.className = 'folder-window';
        folder.id = `folder-${category.name}`;

        let itemsHTML = category.items.map(item => `
          <a href="${item.link}" target="_blank" class="folder-item">
            <span class="icon">${item.icon}</span>
            <span class="label">${item.title}</span>
          </a>
        `).join('');

        folder.innerHTML = `
          <div class="folder-header">
            <div class="folder-controls">
              <div class="folder-control close" onclick="closeFolder('${category.name}')"></div>
              <div class="folder-control minimize"></div>
              <div class="folder-control maximize"></div>
            </div>
            <span class="folder-title">${category.icon} ${category.name}</span>
          </div>
          <div class="folder-content">
            ${itemsHTML}
          </div>
        `;

        container.appendChild(folder);
      });
    }

    // ========================================
    // Folder Controls
    // ========================================
    function openFolder(name) {
      // Close all folders first
      document.querySelectorAll('.folder-window').forEach(f => f.classList.remove('active'));
      // Open target folder
      const folder = document.getElementById(`folder-${name}`);
      if (folder) {
        folder.classList.add('active');
      }
    }

    function closeFolder(name) {
      const folder = document.getElementById(`folder-${name}`);
      if (folder) {
        folder.classList.remove('active');
      }
    }

    // Close folder when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.folder-window') &&
        !e.target.closest('.desktop-icon') &&
        !e.target.closest('.dock-item') &&
        !e.target.closest('.dropdown')) {
        document.querySelectorAll('.folder-window').forEach(f => f.classList.remove('active'));
      }
    });

    // ========================================
    // Initialize
    // ========================================
    loadLinks();

    // Focus password on load if not authenticated
    if (!checkAuth()) {
      setTimeout(() => passwordInput.focus(), 500);
    }

    // ========================================
    // Private Folder Functions
    // ========================================
    let privateLinksData = null;

    async function loadPrivateLinks() {
      if (privateLinksData) return privateLinksData;
      try {
        const response = await fetch('private-links.json');
        privateLinksData = await response.json();
        return privateLinksData;
      } catch (error) {
        console.error('Error loading private links:', error);
        return null;
      }
    }

    function openPrivateFolder() {
      if (checkPrivateAuth()) {
        // Already authenticated, show folder directly
        showPrivateFolderContent();
      } else {
        // Show password modal
        document.getElementById('private-modal').classList.add('active');
        document.getElementById('private-password').focus();
        document.getElementById('private-error').style.display = 'none';
      }
    }

    function submitPrivatePassword() {
      const input = document.getElementById('private-password');
      const error = document.getElementById('private-error');

      if (validatePrivate(input.value)) {
        setPrivateAuth();
        closeModal('private-modal');
        input.value = '';
        error.style.display = 'none';
        showPrivateFolderContent();
      } else {
        error.style.display = 'block';
        input.classList.add('error');
        input.value = '';
        setTimeout(() => input.classList.remove('error'), 500);
      }
    }

    async function showPrivateFolderContent() {
      const data = await loadPrivateLinks();
      if (!data) return;

      const container = document.getElementById('private-folder-content');
      container.innerHTML = data.items.map(item => `
        <a href="${item.link}" target="_blank" class="folder-item">
          <span class="icon">${item.icon}</span>
          <span class="label">${item.title}</span>
        </a>
      `).join('');

      // Close other folders and open private
      document.querySelectorAll('.folder-window').forEach(f => f.classList.remove('active'));
      document.getElementById('folder-Private').classList.add('active');
    }

    // Handle Enter key for private password
    document.getElementById('private-password').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        submitPrivatePassword();
      }
    });

    // ========================================
    // Search Functionality
    // ========================================
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const searchClear = document.getElementById('search-clear');

    function getAllLinks() {
      if (!linksData) return [];
      const allLinks = [];

      linksData.categories.forEach(category => {
        category.items.forEach(item => {
          allLinks.push({
            ...item,
            category: category.name,
            categoryIcon: category.icon
          });
        });
      });

      return allLinks;
    }

    function searchLinks(query) {
      const allLinks = getAllLinks();
      const q = query.toLowerCase().trim();

      if (!q) return [];

      return allLinks.filter(link =>
        link.title.toLowerCase().includes(q) ||
        link.category.toLowerCase().includes(q)
      );
    }

    function renderSearchResults(results) {
      if (results.length === 0) {
        searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
      } else {
        searchResults.innerHTML = results.map(item => `
          <a href="${item.link}" target="_blank" class="search-result-item">
            <span class="icon">${item.icon}</span>
            <div class="info">
              <div class="title">${item.title}</div>
              <div class="category">${item.categoryIcon} ${item.category}</div>
            </div>
          </a>
        `).join('');
      }
      searchResults.classList.add('active');
    }

    searchInput.addEventListener('input', (e) => {
      const query = e.target.value;

      if (query.length > 0) {
        searchClear.style.display = 'block';
        const results = searchLinks(query);
        renderSearchResults(results);
      } else {
        searchClear.style.display = 'none';
        searchResults.classList.remove('active');
      }
    });

    searchInput.addEventListener('focus', () => {
      if (searchInput.value.length > 0) {
        const results = searchLinks(searchInput.value);
        renderSearchResults(results);
      }
    });

    searchClear.addEventListener('click', () => {
      searchInput.value = '';
      searchClear.style.display = 'none';
      searchResults.classList.remove('active');
      searchInput.focus();
    });

    // Close search results when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-container')) {
        searchResults.classList.remove('active');
      }
    });

    // Keyboard shortcut: Cmd/Ctrl + K to focus search
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        searchInput.focus();
      }
      // Escape to clear search
      if (e.key === 'Escape') {
        searchInput.value = '';
        searchClear.style.display = 'none';
        searchResults.classList.remove('active');
        searchInput.blur();
      }
    });
  </script>
</body>

</html>